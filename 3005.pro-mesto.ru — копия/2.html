<div class="mobile-slider">
    <div class="mobile-slider-list">
        <div class="slider-track">
            <div class="slide">
                <img
                    src="https://pro-mesto.ru/api/get-pic/f52fbd90-57d5-44fe-97ae-836c23b17bc1"
                />
            </div>
            <div class="slide">
                <img
                    src="https://pro-mesto.ru/api/get-pic/f73e9eb9-15b4-4d9b-9a4d-8c41dc90afc6"
                />
            </div>
            <div class="slide">
                <img
                    src="https://pro-mesto.ru/api/get-pic/2c0c126f-d286-472a-9dcc-c1117c1d3198"
                />
            </div>
            <div class="slide">
                <img
                    src="https://pro-mesto.ru/api/get-pic/2c0c126f-d286-472a-9dcc-c1117c1d3198"
                />
            </div>
            <div class="slide">
                <img
                    src="https://pro-mesto.ru/api/get-pic/5a2b4dac-1b39-4666-be6a-5536cd4d5117"
                />
            </div>
            <div class="slide">
                <img
                    src="https://pro-mesto.ru/api/get-pic/f73e9eb9-15b4-4d9b-9a4d-8c41dc90afc6"
                />
            </div>
            <div class="slide">
                <img
                    src="https://pro-mesto.ru/api/get-pic/f52fbd90-57d5-44fe-97ae-836c23b17bc1"
                />
            </div>
            <div class="slide">
                <img
                    src="https://pro-mesto.ru/api/get-pic/5a2b4dac-1b39-4666-be6a-5536cd4d5117"
                />
            </div>
            <div class="slide">
                <img src="https://ia.wampi.ru/2020/11/13/004.jpg" />
            </div>
            <div class="slide">
                <img
                    src="https://avatars.mds.yandex.net/i?id=b4a712ec75ae908223ac721d3b89bd0b_l-6503967-images-thumbs&n=13"
                />
            </div>
        </div>
    </div>
</div> 

<div id="modal" class="modal">
    <div class="modal-header" id="modalHeader"></div>
    <span class="close">&times;</span>
    <img class="modal-content" id="modalImage">
    <div id="caption"></div>
</div>

<style>
    
    .mobile-slider {
        position: relative;
        width: 400px;
        height: 300px;
        margin: 50px auto 0;
        user-select: none;
        touch-action: pan-y;
    }

    .slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .mobile-slider-list {
        width: 400px;
        height: 300px;
        overflow: hidden;
    }

    .mobile-slider-list.grab {
        cursor: grab;
    }

    .mobile-slider-list.grabbing {
        cursor: grabbing;
    }

    .slider-track {
        display: flex;
    }
    .mobile-slider {
        position: relative;
        overflow: hidden;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .slide {
        width: 400px;
        height: 300px;
        flex-shrink: 0;
        font-size: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
    
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: none;
        background-color: rgba(0, 0, 0, 0.9);
    }

    .modal-content {
        margin: auto;
        display: block;
        width: 100%;
        height: 100%;
        max-width: none;
        object-fit: contain;
        background-color: black;
    }

    .close {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #fff;
        font-size: 50px;
        font-weight: bold;
        transition: 0.3s;
    }

    .close:hover,
    .close:focus {
        color: #bbb;
        text-decoration: none;
        cursor: pointer;
    }

    .modal-header {
        position: absolute;
        top: 0;
        width: 100%;
        padding: 10px;
        text-align: center;
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        font-size: 40px;
    }
</style>

<script>
    let slider = document.querySelector('.mobile-slider'),
        sliderList = slider.querySelector('.mobile-slider-list'),
        sliderTrack = slider.querySelector('.slider-track'),
        slides = slider.querySelectorAll('.slide'),
        slideWidth = slides[0].offsetWidth,
        slideIndex = 0,
        posInit = 0,
        posX1 = 0,
        posX2 = 0,
        posY1 = 0,
        posY2 = 0,
        posFinal = 0,
        isSwipe = false,
        isScroll = false,
        allowSwipe = true,
        transition = true,
        nextTrf = 0,
        prevTrf = 0,
        lastTrf = --slides.length * slideWidth,
        posThreshold = slides[0].offsetWidth * 0.35,
        trfRegExp = /([-0-9.]+(?=px))/,
        swipeStartTime,
        swipeEndTime,
        getEvent = function () {
            return event.type.search('touch') !== -1 ? event.touches[0] : event
        },
        slide = function () {
            if (transition) {
                sliderTrack.style.transition = 'transform .5s'
            }
            sliderTrack.style.transform = `translate3d(-${
                slideIndex * slideWidth
            }px, 0px, 0px)`
        },
        swipeStart = function () {
            let evt = getEvent()

            if (allowSwipe) {
                swipeStartTime = Date.now()

                transition = true

                nextTrf = (slideIndex + 1) * -slideWidth
                prevTrf = (slideIndex - 1) * -slideWidth

                posInit = posX1 = evt.clientX
                posY1 = evt.clientY

                sliderTrack.style.transition = ''

                document.addEventListener('touchmove', swipeAction)
                document.addEventListener('mousemove', swipeAction)
                document.addEventListener('touchend', swipeEnd)
                document.addEventListener('mouseup', swipeEnd)

                sliderList.classList.remove('grab')
                sliderList.classList.add('grabbing')
            }
        },
        swipeAction = function () {
            let evt = getEvent(),
                style = sliderTrack.style.transform,
                transform = +style.match(trfRegExp)[0]

            posX2 = posX1 - evt.clientX
            posX1 = evt.clientX

            posY2 = posY1 - evt.clientY
            posY1 = evt.clientY

            if (!isSwipe && !isScroll) {
                let posY = Math.abs(posY2)
                if (posY > 7 || posX2 === 0) {
                    isScroll = true
                    allowSwipe = false
                } else if (posY < 7) {
                    isSwipe = true
                }
            }

            if (isSwipe) {
                if (slideIndex === 0) {
                    if (posInit < posX1) {
                        setTransform(transform, 0)
                        return
                    } else {
                        allowSwipe = true
                    }
                }

                // запрет ухода вправо на последнем слайде
                if (slideIndex === --slides.length) {
                    if (posInit > posX1) {
                        setTransform(transform, lastTrf)
                        return
                    } else {
                        allowSwipe = true
                    }
                }

                if (
                    (posInit > posX1 && transform < nextTrf) ||
                    (posInit < posX1 && transform > prevTrf)
                ) {
                    reachEdge()
                    return
                }

                sliderTrack.style.transform = `translate3d(${
                    transform - posX2
                }px, 0px, 0px)`
            }
        },
        swipeEnd = function () {
            posFinal = posInit - posX1

            isScroll = false
            isSwipe = false

            document.removeEventListener('touchmove', swipeAction)
            document.removeEventListener('mousemove', swipeAction)
            document.removeEventListener('touchend', swipeEnd)
            document.removeEventListener('mouseup', swipeEnd)

            sliderList.classList.add('grab')
            sliderList.classList.remove('grabbing')

            if (allowSwipe) {
                swipeEndTime = Date.now()
                if (
                    Math.abs(posFinal) > posThreshold ||
                    swipeEndTime - swipeStartTime < 300
                ) {
                    if (posInit < posX1) {
                        slideIndex--
                    } else if (posInit > posX1) {
                        slideIndex++
                    }
                }

                if (posInit !== posX1) {
                    allowSwipe = false
                    slide()
                } else {
                    allowSwipe = true
                }
            } else {
                allowSwipe = true
            }
        },
        setTransform = function (transform, comapreTransform) {
            if (transform >= comapreTransform) {
                if (transform > comapreTransform) {
                    sliderTrack.style.transform = `translate3d(${comapreTransform}px, 0px, 0px)`
                }
            }
            allowSwipe = false
        },
        reachEdge = function () {
            transition = false
            swipeEnd()
            allowSwipe = true
        }

    sliderTrack.style.transform = 'translate3d(0px, 0px, 0px)'
    sliderList.classList.add('grab')

    sliderTrack.addEventListener('transitionend', () => (allowSwipe = true))
    slider.addEventListener('touchstart', swipeStart)
    

    let modal = document.getElementById('modal');
    let modalImage = document.getElementById('modalImage');
    let closeModal = document.querySelector('.close');
    let modalHeader = document.getElementById('modalHeader');
    let currentIndex = 0;

    slides.forEach((slide, index) => {
        slide.addEventListener('click', function() {
            modal.style.display = 'block';
            currentIndex = index;
            updateModalImage();
        });
    });

    closeModal.addEventListener('click', function() {
        modal.style.display = 'none';
    });

    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });

    function updateModalImage() {
        let img = slides[currentIndex].querySelector('img');
        modalImage.src = img.src;
        modalHeader.textContent = `${currentIndex + 1} из ${slides.length}`;
    }

    let startX = 0;
    let endX = 0;

    modal.addEventListener('touchstart', function(event) {
        startX = event.touches[0].clientX;
    });

    modal.addEventListener('touchend', function(event) {
        endX = event.changedTouches[0].clientX;
        handleSwipe();
    });

    function handleSwipe() {
        if (startX > endX + 50) {
            if (currentIndex < slides.length - 1) {
                currentIndex = (currentIndex + 1) % slides.length;
                updateModalImage();
            }
        } else if (startX < endX - 50) {
            if (currentIndex > 0) {
                currentIndex = (currentIndex - 1 + slides.length) % slides.length;
                updateModalImage();
            }
        }
    }
</script>
